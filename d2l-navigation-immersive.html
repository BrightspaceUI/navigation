<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<link rel="import" href="../d2l-fastdom-import/fastdom.html">
<link rel="import" href="../d2l-resize-observer-polyfill-import/resize-observer.html">
<link rel="import" href="d2l-navigation.html">
<link rel="import" href="d2l-navigation-link-back.html">

<!--
`d2l-navigation-immersive`
Polymer-based web component for the immersive navigation component

@demo demo/navigation-immersive.html
-->

<dom-module id="d2l-navigation-immersive">
	<template strip-whitespace>
		<style>
			.d2l-navigation-immersive {
				display: flex;
				height: 66px;
				justify-content: space-between;
				margin: 0px 30px 0 30px;
				max-width: 1230px;
				overflow: hidden;
			}

			.d2l-navigation-immersive-left ::slotted(*),
			.d2l-navigation-immersive-middle ::slotted(*),
			.d2l-navigation-immersive-right ::slotted(*) {
				height: 100%;
			}

			.d2l-navigation-immersive-left {
				color: var(--d2l-color-tungsten);
				font-size: 14px;
				line-height: 20px;
			}

			.d2l-navigation-immersive-left,
			.d2l-navigation-immersive-middle {
				font-weight: 400;
				letter-spacing: 0.2px;
			}

			.d2l-navigation-immersive-left,
			.d2l-navigation-immersive-right {
				flex: 0 0 auto;
			}

			.d2l-navigation-immersive-middle {
				border-left-color: var(--d2l-color-sylvite);
				border-left-style: solid;
				border-left-width: 1px;
				border-right-color: var(--d2l-color-sylvite);
				border-right-style: solid;
				border-right-width: 1px;
				flex: 0 1 auto;
				font-size: 19px;
				line-height: 28px;
				margin: 0px 24px 0 24px;
				padding: 0px 24px 0 24px;
				width: 100%
			}

			.d2l-navigation-immersive-middle-hidden {
				display: none;
			}

			@media (max-width: 767px) {
				.d2l-navigation-immersive {
					margin: 0px 24px 0 24px;
				}
			}

			@media (max-width: 615px) {
				.d2l-navigation-immersive {
					height: 60px;
					margin: 0px 18px 0 18px;
				}
				.d2l-navigation-immersive-middle {
					margin: 0px 18px 0 18px;
					padding: 0px 18px 0 18px;
				}
			}

			@media (max-width: 478px) {
				.d2l-navigation-immersive-left {
					margin-right: 36px;
				}
				.d2l-navigation-immersive-middle {
					display: none;
				}
			}
		</style>
		<d2l-navigation>
			<div class="d2l-navigation-immersive">
				<div class="d2l-navigation-immersive-left">
					<slot name="left">
						<d2l-navigation-link-back text="[[backbuttontext]]" href="[[backbuttonhref]]"></d2l-navigation-link-back>
					</slot>
				</div>
				<div class="d2l-navigation-immersive-middle">
		    		<slot class="middle-slot" name="middle"></slot>
				</div>
				<div class="d2l-navigation-immersive-right">
	    			<slot name="right"></slot>
				</div>
			</div>
		</d2l-navigation>
	</template>
	<script>
		Polymer({
			is: 'd2l-navigation-immersive',

			properties: {
				backbuttonhref: {
					type: String,
					reflectToAttribute: true
				},
				backbuttontext: {
					type: String,
					reflectToAttribute: true
				}
			},

			ready: function() {
				this._onMiddleResize = this._onMiddleResize.bind(this);
			},

			attached: function() {
				var middle = Polymer.dom(this.root).querySelector('.d2l-navigation-immersive-middle');
				this._middleObserver = new ResizeObserver(this._onMiddleResize);
				this._middleObserver.observe(middle);
			},

			detached: function() {
				var middle = Polymer.dom(this.root).querySelector('.d2l-navigation-immersive-middle');
				if (this._middleObserver) {
					this._middleObserver.unobserve(middle);
				}
			},

			_onMiddleResize: function() {
				var middleContainer = Polymer.dom(this.root).querySelector('.d2l-navigation-immersive-middle');

				if (middleContainer.clientHeight < 1) {
					return;
				}

				var middleSlot = Polymer.dom(this.root).querySelector('.d2l-navigation-immersive-middle > slot').assignedNodes({flatten: true});

				if (!middleSlot || middleSlot.length === 0) {
					fastdom.mutate(function() {
						// nothing in middle
						middleContainer.classList.add('d2l-navigation-immersive-middle-hidden');
					});
					return;
				}
				var elementInSlot = middleSlot[0];

				if (elementInSlot.clientHeight < 1) {
					fastdom.mutate(function() {
						// nothing in middle
						middleContainer.classList.add('d2l-navigation-immersive-middle-hidden');
					});
				} else if (elementInSlot.clientHeight > 0) {
					fastdom.mutate(function() {
						// stuff in middle
						middleContainer.classList.remove('d2l-navigation-immersive-middle-hidden');
					});
				}
			}
		});
	</script>
</dom-module>
